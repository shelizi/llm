# RAG UI 整合功能指南

## 功能概述

本次更新將檔案選擇建立索引的功能整合到檔案狀態表格中，提供更直觀和便捷的使用體驗。

## 主要改進

### 1. 檔案狀態表格整合
- **新增checkbox選擇功能**：每個檔案行都有checkbox，可以單獨選擇或批量選擇
- **全選/取消全選**：表格標題行有全選checkbox，右上角有全選/取消按鈕
- **選擇計數器**：實時顯示已選擇的檔案數量
- **智能狀態指示**：根據檔案狀態動態顯示不同顏色的標籤

### 2. 索引參數設定區域
- **保持原位置**：索引相關參數（Chunk Size、Overlap）仍在左側卡片中
- **動態按鈕狀態**：根據選擇狀態啟用/禁用索引按鈕
- **智能按鈕文字**：顯示將要處理的檔案數量
- **錯誤狀態處理**：當選中的檔案有錯誤狀態時，會顯示批量重置按鈕

### 3. 增強的用戶體驗
- **即時反饋**：選擇狀態即時更新，按鈕狀態同步變化
- **批量操作**：支持一次選擇多個檔案進行索引
- **錯誤恢復**：提供批量重置錯誤狀態的功能
- **狀態保持**：自動狀態更新時保持選擇狀態

## 使用方法

### 基本操作流程
1. **上傳檔案**：在左側上傳卡片中選擇並上傳檔案
2. **選擇檔案**：在右側檔案狀態表格中勾選要建立索引的檔案
3. **設定參數**：在左側參數設定區域調整Chunk Size和Overlap
4. **開始索引**：點擊"開始索引選中的檔案"按鈕

### 進階功能
- **全選操作**：點擊表格標題的checkbox或右上角的"全選/取消"按鈕
- **錯誤處理**：當選中檔案有錯誤狀態時，會出現"重置選中檔案的錯誤狀態"按鈕
- **狀態監控**：頁面每10秒自動更新檔案狀態，無需手動刷新

## 技術特性

### 前端改進
- **響應式設計**：使用Bootstrap 5框架，支持各種螢幕尺寸
- **AJAX更新**：狀態更新不會影響用戶的選擇狀態
- **表單驗證**：確保必要參數正確提交
- **錯誤處理**：完善的錯誤提示和異常處理

### 後端兼容
- **無縫整合**：後端API無需修改，完全兼容現有功能
- **批量處理**：支持同時處理多個檔案的索引建立
- **狀態管理**：完整的檔案狀態追蹤和更新機制

## 檔案狀態說明

- **未索引**：檔案已上傳但尚未建立索引
- **已上傳**：檔案剛上傳完成
- **索引中**：正在建立索引（包含多個子狀態：讀取中、建立文檔中等）
- **已索引**：索引建立完成，可用於查詢
- **錯誤**：索引建立過程中發生錯誤

## 測試指南

### 手動測試
1. 啟動服務：`python start_web.py`
2. 訪問：http://127.0.0.1:8001/ui
3. 測試各項功能：上傳、選擇、索引、查詢

### 自動測試
運行整合測試腳本：
```bash
cd RAG
python test_ui_integration.py
```

## 故障排除

### 常見問題
1. **按鈕無法點擊**：確保已選擇至少一個檔案
2. **狀態不更新**：檢查網路連接和服務器狀態
3. **選擇狀態丟失**：可能是頁面刷新導致，重新選擇即可

### 日誌檢查
- 查看瀏覽器控制台的JavaScript錯誤
- 檢查服務器日誌中的處理狀態
- 確認檔案上傳目錄的權限設定

## 查詢功能優化

### 新的查詢界面設計
- **滿版寬度**：查詢區域移到頁面下方，使用完整寬度顯示
- **美觀列表**：查詢結果採用卡片式列表設計，視覺效果更佳
- **智能回答**：使用漸變背景突出顯示AI生成的回答
- **來源展示**：每個參考來源以獨立卡片形式展示，包含相似度評分

### 增強的用戶體驗
- **動態載入**：查詢過程中顯示載入動畫和進度提示
- **相似度視覺化**：使用顏色編碼顯示文檔相似度（綠色=高、橙色=中、紅色=低）
- **快捷操作**：支持回車鍵快速查詢，一鍵清除結果
- **響應式設計**：適配不同螢幕尺寸，移動端友好

### 查詢結果結構
```
📊 查詢統計: 找到 X 個相關文檔片段，最高相似度: XX%

💡 智能回答
[AI生成的回答內容]

📄 參考來源 (X)
├─ 📄 檔案名稱 [相似度: XX%]
│  └─ 📝 相關文檔片段
├─ 📄 檔案名稱 [相似度: XX%]
│  └─ 📝 相關文檔片段
└─ ...
```

## 技術實現詳情

### CSS樣式系統
- **漸變背景**：使用CSS漸變為回答區域創建視覺層次
- **卡片效果**：box-shadow和border-radius創建現代卡片設計
- **懸停效果**：來源卡片支持懸停動畫提升互動性
- **載入動畫**：CSS動畫實現平滑的載入指示器

### JavaScript功能
- **異步處理**：使用async/await處理查詢請求
- **狀態管理**：動態控制按鈕狀態和結果顯示
- **錯誤處理**：完善的錯誤提示和異常處理機制
- **鍵盤支持**：回車鍵快捷查詢功能

## 測試指南

### 查詢功能測試
運行查詢UI測試腳本：
```bash
cd RAG
python test_query_ui.py
```

### 手動測試步驟
1. 確保有已索引的文檔
2. 在查詢輸入框中輸入問題
3. 點擊查詢按鈕或按回車鍵
4. 觀察結果顯示效果
5. 測試清除結果功能

## 未來改進計劃

- 支援拖拽上傳檔案
- 增加檔案預覽功能
- 提供更詳細的索引進度顯示
- 支援檔案分類和標籤管理
- 查詢歷史記錄功能
- 結果導出和分享功能
- 多語言查詢支持
- 查詢建議和自動完成